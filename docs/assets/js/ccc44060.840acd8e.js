"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3702],{3905:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>f});var n=r(67294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var s=n.createContext({}),c=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},p=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=c(r),m=a,f=u["".concat(s,".").concat(m)]||u[m]||d[m]||o;return r?n.createElement(f,i(i({ref:t},p),{},{components:r})):n.createElement(f,i({ref:t},p))}));function f(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,i=new Array(o);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:a,i[1]=l;for(var c=2;c<o;c++)i[c]=r[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},3153:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var n=r(83117),a=(r(67294),r(3905));const o={title:"\u83b7\u53d6\u8fb9\u7f18\u76d1\u63a7",sidebar_position:4},i=void 0,l={unversionedId:"advanced/metrics",id:"advanced/metrics",title:"\u83b7\u53d6\u8fb9\u7f18\u76d1\u63a7",description:"Enable kubectl logs/exec feature",source:"@site/i18n/zh/docusaurus-plugin-content-docs/current/advanced/metrics.md",sourceDirName:"advanced",slug:"/advanced/metrics",permalink:"/docs/advanced/metrics",draft:!1,editUrl:"https://github.com/kubeedge/website/blob/master/docs/advanced/metrics.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{title:"\u83b7\u53d6\u8fb9\u7f18\u76d1\u63a7",sidebar_position:4},sidebar:"documentationSideBar",previous:{title:"\u542f\u7528Kubectl logs/exec/attach\u7b49\u80fd\u529b",permalink:"/docs/advanced/debug"},next:{title:"\u4f7f\u7528EdgeMesh\u5b9e\u73b0\u8de8\u8fb9\u8fb9\u901a\u4fe1",permalink:"/docs/advanced/edgemesh"}},s={},c=[{value:"Enable <code>kubectl logs/exec</code> feature",id:"enable-kubectl-logsexec-feature",level:2},{value:"Deploy metrics server",id:"deploy-metrics-server",level:2},{value:"Download Configuration",id:"download-configuration",level:3},{value:"Update Deploy Configuration",id:"update-deploy-configuration",level:3},{value:"Deploy",id:"deploy",level:3},{value:"Test",id:"test",level:3}],p={toc:c},u="wrapper";function d(e){let{components:t,...r}=e;return(0,a.kt)(u,(0,n.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"enable-kubectl-logsexec-feature"},"Enable ",(0,a.kt)("inlineCode",{parentName:"h2"},"kubectl logs/exec")," feature"),(0,a.kt)("p",null,"Refer to this ",(0,a.kt)("a",{parentName:"p",href:"./debug"},"doc"),"."),(0,a.kt)("h2",{id:"deploy-metrics-server"},"Deploy metrics server"),(0,a.kt)("p",null,"Here we use v0.4.1 metrics-server, please use v0.4.0+ version since it supports automatic port identification after v0.4.0."),(0,a.kt)("p",null,"v0.4.1 have fixed a harmless stack dump error, details see ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/kubernetes-sigs/metrics-server/pull/634"},"this pr"),"."),(0,a.kt)("h3",{id:"download-configuration"},"Download Configuration"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ wget https://github.com/kubernetes-sigs/metrics-server/releases/download/v0.4.0/components.yaml -O deploy.yaml\n")),(0,a.kt)("h3",{id:"update-deploy-configuration"},"Update Deploy Configuration"),(0,a.kt)("p",null,"Update ",(0,a.kt)("inlineCode",{parentName:"p"},"deploy.yaml")," as below:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Add affinity and tolerations configuration:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"spec:\n  template:\n    spec:\n      affinity:\n        nodeAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            nodeSelectorTerms:\n            - matchExpressions:\n              - key: node-role.kubernetes.io/master\n                operator: Exists\n      tolerations:\n      - key: node-role.kubernetes.io/master\n        operator: Exists\n        effect: NoSchedule\n"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Enable hostnetwork mode:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"spec:\n  template:\n    spec:\n      hostNetwork: true\n"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Skip tls insecure:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"spec:\n  template:\n    spec:\n      containers:\n      - args:\n        - --kubelet-insecure-tls\n")))),(0,a.kt)("h3",{id:"deploy"},"Deploy"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubectl apply -f deploy.yaml\nserviceaccount/metrics-server created\nclusterrole.rbac.authorization.k8s.io/system:aggregated-metrics-reader created\nclusterrole.rbac.authorization.k8s.io/system:metrics-server created\nrolebinding.rbac.authorization.k8s.io/metrics-server-auth-reader created\nclusterrolebinding.rbac.authorization.k8s.io/metrics-server:system:auth-delegator created\nclusterrolebinding.rbac.authorization.k8s.io/system:metrics-server created\nservice/metrics-server created\ndeployment.apps/metrics-server created\napiservice.apiregistration.k8s.io/v1beta1.metrics.k8s.io created\n")),(0,a.kt)("h3",{id:"test"},"Test"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubectl top node\n")),(0,a.kt)("p",null,"It would output all nodes as following:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"NAME                 CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%\nedge-node            1169m        29%    3605Mi          45%\ntest-control-plane   121m         3%     664Mi           8%\n")))}d.isMDXComponent=!0}}]);