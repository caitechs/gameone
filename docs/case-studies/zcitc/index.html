<!doctype html>
<html lang="zh" dir="ltr" class="mdx-wrapper mdx-page plugin-pages plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">浙江志诚软件有限公司 | CassItComp</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://caitechs.github.io/gameone/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://caitechs.github.io/gameone/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://caitechs.github.io/gameone/case-studies/zcitc/"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="浙江志诚软件有限公司 | CassItComp"><meta data-rh="true" name="description" content="志诚团队使用KubeEdge，解决了停车场场景下应用编排、部署、更新等难题，提升了城市停车资源整合管理效率。"><meta data-rh="true" property="og:description" content="志诚团队使用KubeEdge，解决了停车场场景下应用编排、部署、更新等难题，提升了城市停车资源整合管理效率。"><link data-rh="true" rel="canonical" href="https://caitechs.github.io/gameone/case-studies/zcitc/"><link data-rh="true" rel="alternate" href="https://caitechs.github.io/gameone/case-studies/zcitc/" hreflang="zh"><link data-rh="true" rel="alternate" href="https://caitechs.github.io/gameone/case-studies/zcitc/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/gameone/blog/rss.xml" title="CassItComp RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/gameone/blog/atom.xml" title="CassItComp Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9PL5BPEXGS"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-9PL5BPEXGS",{anonymize_ip:!0})</script>






<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
<link rel="shortcut icon" type="image/x-icon" href="/favicons/favicon.ico">
<link rel="manifest" href="/favicons/site.webmanifest">
<meta name="theme-color" content="#ffffff">
<meta name="msapplication-config" content="/favicons/browserconfig.xml"><link rel="stylesheet" href="/gameone/assets/css/styles.c5a3b718.css">
<link rel="preload" href="/gameone/assets/js/runtime~main.94491653.js" as="script">
<link rel="preload" href="/gameone/assets/js/main.07136e89.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/gameone/"><div class="navbar__logo"><img src="/gameone/img/avatar.png" alt="" class="themedImage_ToTc themedImage--light_HNdA"><img src="/gameone/img/avatar.png" alt="" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Gameone 机器自动评分系统</b></a><a class="navbar__item navbar__link" target="_self" href="/gameone/docs">文档</a><a class="navbar__item navbar__link" target="_self" href="/gameone/blog">博客  </a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/gameone/case-studies">案例中心</a><a class="navbar__item navbar__link" href="/gameone/partners">合作伙伴</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/caitechs/gameone" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link heade-icon"></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>中文</a><ul class="dropdown__menu"><li><a href="/gameone/case-studies/zcitc/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh">中文</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><main class="container container--fluid margin-vert--lg"><div class="row mdxPageWrapper_j9I6"><div class="col col--8"><article><h1>引言</h1><p>随着城市各类停车资源不断接入、应用场景不断拓展，边缘端的应用越来越复杂，边缘节点的数量快速增长、产生的数据也越来越多，为边缘应用的管理带来一系列挑战。主要表现在：
(1) 复杂网络拓扑、不稳定网络接入。旧停车场智能化改造与新智能停车场建设时，要根据项目要求、物理位置、道路规划等情况，合理规划网络。有些停车场规模大、具备铺设光纤的条件，可采用专线接入；有些停车场出入口距离较远，或道路分隔不方便开挖铺设线路，则只能采用移动网络做补充。这些网络的质量参差不齐，市政施工等情况偶尔也会导致断电、断网，对系统的高可用性带来挑战。</p><p>(2) 需求高度定制、快速迭代更新。城市平台接入的停车资源类型多种多样，有公共的道路停车位、商业停车场、社区停车场、退红空间等。停车场的前端采集技术不同、运营主体不同、收缴费策略不同等等，使得单一版本的停车场应用无法满足需求。在停车场建设完成后，为配合停车场运营，如在特殊时期配合商业活动、推出联动停车费用减免等，仍需对应用进行定制、更新。这些因素，要求停车场应用有良好的版本控制、较好的扩展性、较强的弹性部署能力。</p><p>(3) 边缘网关异构硬件的挑战。停车场规模不同、对计算资源的需求差异很大。小的停车场可能仅有单一通道、十几个停车位，大的停车场拥有十几个通道、成百上千个停车位，且可能被划分为不同的区域，不同区域计费方案也不同。根据计算资源需求选购的网关设备覆盖 x86_64、aarch32、aarch64 等不同 CPU 体系架构，增加了技术栈的复杂性，给研发团队带来管理上的挑战。</p><p>浙江志诚软件有限公司长期致力于提供城市级路内外一体化智慧停车解决方案，并通过大数据实现全城停车资源的智慧联动。为解决无人值守停车场等管理所需的高安全、高可靠、高效率、易维护等特性，志诚团队越来越多地在停车场现场的边缘节点部署容器化应用。</p><h1>云原生边缘计算技术</h1><p>边缘计算是一种分布式的计算架构，相对于云中心计算，将应用程序从云中心节点移往边缘节点去处理，本质上更靠近于用户终端，可以加快数据的处理与传送速度，减少延迟。云原生（Cloud Native）则是一种构建和运行应用程序的方法，是一套技术体系和方法论，目前通常采用开源堆栈（Kubernetes+Docker）进行容器化，基于微服务架构提高灵活性和可维护性，借助敏捷方法、DevOps 支持持续迭代和运维自动化，利用云平台设施实现弹性伸缩、动态调度、优化资源利用率。</p><p>随着计算规模和业务复杂度的日益提升，对边缘计算的效率、可靠性、资源利用率等一系列能力提出了新的诉求。为了将云计算的能力下沉到边缘侧、设备侧，并通过中心进行统一交付、运维、管控，云原生与边缘计算结合，衍生出一种新的技术趋势——云原生边缘计算，即基于边缘计算进行应用设计开发，以充分利用边缘计算的优势，实现离线运行能力、边云协同能力、海量设备接入等多种特殊能力的支持。KubeEdge 是基于 Kubernetes 架构体系实现云原生边缘计算的典型代表。其整体架构如下：</p><p><img loading="lazy" alt="kubeedge架构" src="/gameone/assets/images/kubeedgeArchitecture-44abe79eb571f73261a1c03f8a78f501.png" width="771" height="647" class="img_ev3q"></p><h1>基于云原生架构智慧停车操作系统的能力构成</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="整体架构">整体架构<a href="#整体架构" class="hash-link" aria-label="整体架构的直接链接" title="整体架构的直接链接">​</a></h2><p>路内外一体化开放式智慧停车平台，其目标是整合路内、路外停车资源，融合静态、动态交通大数据，纳入不同运营主体打造开放生态，为停车场的管理者和使用者提供平台化的运营服务和解决方案。通过基于云原生的整体架构，志诚公司实现了停车场全部服务容器化，同时根据业务需要部署在云计算中心或边缘计算节点。云平台的服务、停车场现场的传感器和控制设备以及边缘侧的应用，共同构建了停车云服务体系。</p><p><img loading="lazy" alt="实践架构图" src="/gameone/assets/images/systemStructure-ff1d05d0d5f993bf0b0a9a4f928c2509.png" width="864" height="526" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="技术实现">技术实现<a href="#技术实现" class="hash-link" aria-label="技术实现的直接链接" title="技术实现的直接链接">​</a></h2><p>Kubernetes 提供了一组对云原生应用的编排部署模型，KubeEdge 将这些编排部署的能力延伸到边缘侧，支持边缘侧日益复杂的业务和高可用性的要求。下图展示了 Kubernetes 集群各部分之间的联系。</p><p><img loading="lazy" alt="实践架构图" src="/gameone/assets/images/KubernetesCluster-250e2a39715444c0406b4d15bc939d24.png" width="874" height="561" class="img_ev3q"></p><p>其中，停车场边缘侧被设计为一组低耦合的容器化应用，充分利用 Kubernetes 和 KubeEdge的特性，以满足停车场的功能需求。</p><p><img loading="lazy" alt="实践架构图" src="/gameone/assets/images/EdgeArchitecture-fc138fb563e9418df698ad3d1dd8ccc9.png" width="868" height="649" class="img_ev3q"></p><p>如上图所示，停车场边缘侧部署的应用主要包括：
(1) 基础服务组。采用开源的 Postgres 数据库存储业务数据；采用 Redis 做 LRU 缓存，以提高整体性能、降低磁盘 IO 的开销。而 Zabbix 负责物理机的健康监控，Zeroconf Service 则为岗亭收费终端等用户界面提供网关发现等服务。
(2) Gateway Broker 网关消息服务。提供边缘侧各业务应用的消息订阅、发布，以及与云测服务（停车云平台）的双向消息透传。
(3) 设备集成应用组。若干独立的设备服务应用，分别提供了停车场摄像机、闸机、余位显示屏、语音播报、车辆检测器等传感器和控制设备的集成。低耦合的设备服务可根据停车场情况选择必要的服务组件。
(4) 存储与上传应用组。这些应用分别提供持久化、上传、容量监控、磁盘清理等功能。StorageService 带来了图片、视频等传感器数据的本地持久化存储能力；DiskUsageService 提供实时的磁盘容量监控功能；DiskCleanService 则实现了定期数据清理功能；UploadService 则负责数据的上传，根据数据优先级别调度上传任务。
(5) 业务应用组。提供车辆进出场的订单生成、通道控制、缴费计算等。</p><p>而通过编排部署上述应用，可以实现停车场如下功能特性：
(1) 边缘侧数据库主从配置
在规模较大、对可用性要求高的停车场（如大型商业体、体育中心等），需要提供双机甚或多机热备方案。在边缘计算部署上，采用两台或多台独立的物理网网关主机（拥有独立供电、独立网络的设备），每个主机构成一个 Kubernetes 节点。Postgres 数据库应用、Redis 缓存
应用利用 Stafulset 机制，在应用重新调度后，应用还能被调度到原来的节点至上，保障访问同样的存储。</p><p><img loading="lazy" alt="实践架构图" src="/gameone/assets/images/MasterSlave-f789645b08bf1d85801f9a5b1524d043.png" width="867" height="412" class="img_ev3q"></p><p>(2) 多活互备
利用 Kubernetes 的 ReplicaSet 创建多个副本，形成多活互备方案。ReplicaSet 可以维持设定副本数的应用同时运行，已提供负载均衡和高可用性。
(3) 关联应用同节点部署
停车场边缘侧，停车场管理应用 ParkingLotService 跟设备控制服务 DeviceService 有强关联性，通常在同节点部署，以提升应用间交互效率，实现最快速的事件处理和控制输出。使用POD 亲和性调度规则，可以把相关的应用部署在相同的主机上以提升通信性能。
(4) 同一应用多实例跨节点部署
同一应用的不同实例跨节点部署可提升可用性。停车场管理应用 ParkingLotService 等应用，可部署多个实例。当停车场边缘侧存在两个或多个节点的情况下，利用 POD 反亲和性特性，可以将同一应用的不同实例分散在不同节点上进行部署。特别地，有些小规模停车场，只有一台网关设备（单节点），则可以在云侧 Kubernetes 集群部署应用实例副本，在不增加成本的情况下，提高应用可用性。
(5) 根据边缘节点的属性分组部署
因停车场建设时期不同，边缘节点的 CPU 体系架构可能是 x86_64，也可能是低功耗的aarch32 或 aarch64，要部署的应用版本完全不同。停车场内的相机、道闸等型号也会影响部署的应用版本。我们依据边缘节点的地理位置、设备类型、功能属性、性能等分属于不同的分组，打上不同的标签，在应用部署时利用 NodeSelector 的能力，将应用部署在对应 label 上的边缘节点之上。
(6) 新节点自动安装部署
在 Kubernetes 中定义应用部署，独立于具体的节点。应用根据节点的标签将期望的应用部署在对应的节点之上。当新的节点上线后，可以自动（或后期手工维护）将其打上同样的标签，K8s系统可以立刻将应用自动部署在新上线的边缘节点之上。
(7) 多停车场联动
有些复杂场景，多个停车场边缘节点需要实时通信、交换数据。如大型社区，停车场被分为多个组团，母场和子场嵌套，停车计费分段、分区域缴费，数据处理时需要结合关联的停车场数据。KubeEdge 集成了一个名为 EdgeMesh 的模块，负责边缘侧流量的转发，支持跨节点流量转发。EdgeMesh 为资源受限的边缘侧提供了一个轻量化且高度集成的服务发现服务。利用 EdgeMesh的能力，可实现多停车场实时联动、附近道路交通诱导屏实时联动，为车主提供准确的停车诱导和计费服务。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="应用效果">应用效果<a href="#应用效果" class="hash-link" aria-label="应用效果的直接链接" title="应用效果的直接链接">​</a></h2><p>目前，志诚智慧停车操作系统通过国产化信创改造，容器化的应用全部适配 x86_64、aarch32 和 aarch64 等 CPU 体系架构的计算平台，可弹性适应停车场的规模和建设成本。网关设备通过轻量级通信协议 MQTT 进行消息通信，低耗稳定，极大地减轻了带宽压力。Kubernetes 的容器编排能力，带来了停车场系统的快速部署和高可用性。</p><p>在实践中，实施团队可以根据停车场规模、停车周转率等情况，按照“一区块一策略一方案”的思路，在现场部署一台或若干台算力适合的边缘网关设备，作为边缘计算平台。边缘计算为云平台提供如下能力：
(1) 停车场设备智能接入。实现进出口摄像机、车辆检测器等传感器数据的收集和上报，以及闸机、余位显示屏、语音播报等控制单元的联网控制。
(2) 业务数据的双向同步。与云端实时通信，接收云端下发的停车场、通道、车辆白名单等基础信息；预处理进出场车辆信息，形成停车订单，并根据计费方案计算费用。业务数据具备双向同步能力，且保证数据的一致性
(3) 短时离线工作能力。对短时断线的情况下，为车主提供有限的服务，如开闸进场、白名单及免费订单开闸出场、停车场离线计费等。网络恢复时，数据自动同步，以保持云端和边缘端的数据一致性。
(4) 负载均衡和高可用性。弹性部署，部分关键业务能满足“单点多活”、“云-边”异地多活等场景，为停车场业务提供了负载均衡和高可用性。
(5) 持续交付、快速部署和更新应用。全容器化应用，结合 Kubernetes 和 KubeEdge 的编排部署能力，实现了停车场业务的快速迭代和持续交付，具备了对边缘节点自动部署、更新、回滚的运维管理能力。</p><h1>结束语</h1><p>目前无人收费服务以及线上运营都属于早期蓝海市场，且为用户提供降本增效的核心价值。未来，志诚将继续围绕物联网、边缘计算等技术为停车场提供智能运营能力，致力于提高车位周转率和车位占用率，降低人力成本，进而提高车场运营收益。</p></article></div><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#整体架构" class="table-of-contents__link toc-highlight">整体架构</a></li><li><a href="#技术实现" class="table-of-contents__link toc-highlight">技术实现</a></li><li><a href="#应用效果" class="table-of-contents__link toc-highlight">应用效果</a></li></ul></div></div></div></main></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">2023 © GameOne Project Authors. All rights reserved. GameOne项目组，版权所有！</div></div></div></footer></div>
<script src="/gameone/assets/js/runtime~main.94491653.js"></script>
<script src="/gameone/assets/js/main.07136e89.js"></script>
</body>
</html>