<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-architecture/edge/devicetwin">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">DeviceTwin | CassItComp</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://cassitcomp.org/gameone/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://cassitcomp.org/gameone/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://cassitcomp.org/gameone/docs/architecture/edge/devicetwin"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="DeviceTwin | CassItComp"><meta data-rh="true" name="description" content="Overview"><meta data-rh="true" property="og:description" content="Overview"><link data-rh="true" rel="canonical" href="https://cassitcomp.org/gameone/docs/architecture/edge/devicetwin"><link data-rh="true" rel="alternate" href="https://cassitcomp.org/gameone/docs/architecture/edge/devicetwin" hreflang="zh"><link data-rh="true" rel="alternate" href="https://cassitcomp.org/gameone/docs/architecture/edge/devicetwin" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/gameone/blog/rss.xml" title="CassItComp RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/gameone/blog/atom.xml" title="CassItComp Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9PL5BPEXGS"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-9PL5BPEXGS",{anonymize_ip:!0})</script>






<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
<link rel="shortcut icon" type="image/x-icon" href="/favicons/favicon.ico">
<link rel="manifest" href="/favicons/site.webmanifest">
<meta name="theme-color" content="#ffffff">
<meta name="msapplication-config" content="/favicons/browserconfig.xml"><link rel="stylesheet" href="/gameone/assets/css/styles.c43b1bd9.css">
<link rel="preload" href="/gameone/assets/js/runtime~main.ff278b7d.js" as="script">
<link rel="preload" href="/gameone/assets/js/main.b549cb7b.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/gameone/"><div class="navbar__logo"><img src="/gameone/img/avatar.png" alt="" class="themedImage_ToTc themedImage--light_HNdA"><img src="/gameone/img/avatar.png" alt="" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Gameone 机器自动评分系统</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" target="_self" href="/gameone/docs">文档</a><a class="navbar__item navbar__link" target="_self" href="/gameone/blog">博客  </a><a class="navbar__item navbar__link" href="/gameone/case-studies">案例中心</a><a class="navbar__item navbar__link" href="/gameone/partners">合作伙伴</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/kubeedge/kubeedge" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link heade-icon"></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>中文</a><ul class="dropdown__menu"><li><a href="/gameone/docs/architecture/edge/devicetwin" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh">中文</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/gameone/docs/">入门指南</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gameone/docs/">为什么选择KubeEdge</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gameone/docs/welcome/getting-started">快速开始</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gameone/docs/welcome/available-doc-versions">支持的文档版本</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/gameone/docs/category/setup">安装</a><button aria-label="打开/收起侧边栏菜单「安装」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/gameone/docs/category/architecture">KubeEdge架构</a><button aria-label="打开/收起侧边栏菜单「KubeEdge架构」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gameone/docs/architecture/beehive">公共组件</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/gameone/docs/category/cloud-components">云上组件</a><button aria-label="打开/收起侧边栏菜单「云上组件」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/gameone/docs/category/edge-components">边缘组件</a><button aria-label="打开/收起侧边栏菜单「边缘组件」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/gameone/docs/architecture/edge/edged">Edged</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/gameone/docs/architecture/edge/eventbus">EventBus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/gameone/docs/architecture/edge/edgehub">EdgeHub</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/gameone/docs/architecture/edge/devicetwin">DeviceTwin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/gameone/docs/architecture/edge/metamanager">MetaManager</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/gameone/docs/architecture/edge/servicebus">ServiceBus</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/gameone/docs/category/core-concept">核心概念</a><button aria-label="打开/收起侧边栏菜单「核心概念」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/gameone/docs/category/advanced-configuration">高级配置</a><button aria-label="打开/收起侧边栏菜单「高级配置」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/gameone/docs/category/developer-guide">开发者指南</a><button aria-label="打开/收起侧边栏菜单「开发者指南」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/gameone/docs/category/community">社区</a><button aria-label="打开/收起侧边栏菜单「社区」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/gameone/docs/category/subproject">KubeEdge子项目</a><button aria-label="打开/收起侧边栏菜单「KubeEdge子项目」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/gameone/docs/category/frequently-asked-questions-faq">常见问题</a><button aria-label="打开/收起侧边栏菜单「常见问题」" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/gameone/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/gameone/docs/category/architecture"><span itemprop="name">KubeEdge架构</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/gameone/docs/category/edge-components"><span itemprop="name">边缘组件</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">DeviceTwin</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>DeviceTwin</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Overview的直接链接" title="Overview的直接链接">​</a></h2><p>DeviceTwin module is responsible for storing device status, dealing with device attributes, handling device twin operations, creating a membership
between the edge device and edge node, syncing device status to the cloud and syncing the device twin information between edge and cloud.
It also provides query interfaces for applications. Device twin consists of four sub modules (namely membership module, communication
module, device module and device twin module) to perform the responsibilities of device twin module.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="operations-performed-by-device-twin-controller">Operations Performed By Device Twin Controller<a href="#operations-performed-by-device-twin-controller" class="hash-link" aria-label="Operations Performed By Device Twin Controller的直接链接" title="Operations Performed By Device Twin Controller的直接链接">​</a></h2><p> The following are the functions performed by device twin controller:</p><ul><li>Sync metadata to/from db ( Sqlite )</li><li>Register and Start Sub Modules</li><li>Distribute message to Sub Modules</li><li>Health Check</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sync-metadata-tofrom-db--sqlite-">Sync Metadata to/from db ( Sqlite )<a href="#sync-metadata-tofrom-db--sqlite-" class="hash-link" aria-label="Sync Metadata to/from db ( Sqlite )的直接链接" title="Sync Metadata to/from db ( Sqlite )的直接链接">​</a></h3><p>For all devices managed by the edge node , the device twin performs the below operations:</p><ul><li>It checks if the device in the device twin context (the list of devices are stored inside the device twin context), if not it adds a mutex to the context.</li><li>Query device from database</li><li>Query device attribute from database</li><li>Query device twin from database</li><li>Combine the device, device attribute and device twin data together into a single structure and stores it in the device twin context.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="register-and-start-sub-modules">Register and Start Sub Modules<a href="#register-and-start-sub-modules" class="hash-link" aria-label="Register and Start Sub Modules的直接链接" title="Register and Start Sub Modules的直接链接">​</a></h3><p>Registers the four device twin modules and starts them as separate go routines</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="distribute-message-to-sub-modules">Distribute Message To Sub Modules<a href="#distribute-message-to-sub-modules" class="hash-link" aria-label="Distribute Message To Sub Modules的直接链接" title="Distribute Message To Sub Modules的直接链接">​</a></h3><ol><li>Continuously listen for any device twin message in the beehive framework.</li><li>Send the received message to the communication module of device twin</li><li>Classify the message according to the message source, i.e. whether the message is from eventBus, edgeManager or edgeHub,
and fills the action module map of the module (ActionModuleMap is a map of action to module)</li><li>Send the message to the required device twin module</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="health-check">Health Check<a href="#health-check" class="hash-link" aria-label="Health Check的直接链接" title="Health Check的直接链接">​</a></h3><p>The device twin controller periodically ( every 60 s ) sends ping messages to submodules. Each of the submodules updates the timestamp in a map for itself once it receives a ping.
The controller checks if the timestamp for a module is more than 2 minutes old and restarts the submodule if true.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="modules">Modules<a href="#modules" class="hash-link" aria-label="Modules的直接链接" title="Modules的直接链接">​</a></h2><p>DeviceTwin consists of four modules, namely:</p><ul><li>Membership Module</li><li>Twin Module</li><li>Communication Module</li><li>Device Module</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="membership-module">Membership Module<a href="#membership-module" class="hash-link" aria-label="Membership Module的直接链接" title="Membership Module的直接链接">​</a></h3><p>The main responsibility of the membership module is to provide membership to the new devices added through the cloud to the edge node.
This module binds the newly added devices to the edge node and creates a membership between the edge node and the edge devices.</p><p>The major functions performed by this module are:-</p><ol><li>Initialize action callback map which is a map<!-- -->[string]<!-- -->Callback that contains the callback functions that can be performed</li><li>Receive the messages sent to membership module</li><li>For each message the action message is read and the corresponding function is called</li><li>Receive heartbeat from the heartbeat channel and send a heartbeat to the controller</li></ol><p>The following are the action callbacks which can be performed by the membership module:</p><ul><li>dealMembershipGet</li><li>dealMembershipUpdated</li><li>dealMembershipDetail</li></ul><p><strong>dealMembershipGet</strong>: dealMembershipGet() gets the information  about the devices associated with the particular edge node from the cache.</p><ul><li><p>The eventbus first receives a message on its subscribed topic (membership-get topic).</p></li><li><p>This message arrives at the  devicetwin controller, which further sends the message to membership module.</p></li><li><p>The membership module gets the devices associated with the edge node from the cache (context) and sends the information to the communication module.It also handles errors that may arise while performing the  aforementioned process and sends the error to the communication module instead of device details.</p></li><li><p>The communication module sends the information to the  eventbus component which further publishes the result on the specified MQTT topic (get membership result topic).</p><p><img loading="lazy" alt="Membership Get()" src="/gameone/assets/images/membership-get-1f90570c3aa77909df7153478f52cf3c.png" width="789" height="294" class="img_ev3q"></p></li></ul><p><strong>dealMembershipUpdated</strong>: dealMembershipUpdated() updates the membership details of the node. It adds the devices, that were newly added, to the edge group and removes the devices, that were removed, from the edge group and updates device details, if they have been altered or updated.</p><ul><li><p>The edgehub module receives the membership update message from the cloud and forwards the message to devicetwin controller which further forwards it to the membership module.</p></li><li><p>The membership  module adds devices that are newly added, removes devices that have been recently deleted and also updates the devices that were already existing in the database as well as in the cache.</p></li><li><p>After updating the details of the devices a  message is sent to the communication module of the device twin, which sends the message to eventbus module to be published on the given MQTT topic.</p><p><img loading="lazy" alt="Membership Update" src="/gameone/assets/images/membership-update-41e2bf4e247cf1d16e412addcc73af6d.png" width="843" height="483" class="img_ev3q"></p></li></ul><p><strong>dealMembershipDetail</strong>: dealMembershipDetail() provides the membership details of the edge node, providing information about the devices associated with the edge node, after removing the membership details of recently removed devices.</p><ul><li><p>The eventbus module receives the message that arrives on the subscribed topic,the message is then forwarded  to the devicetwin controller which further forwards it to the membership module.</p></li><li><p>The membership  module adds devices that are mentioned in the message, removes devices that that are not present in the cache.</p></li><li><p>After updating the details of the devices a message is sent to the communication module of the device twin.</p><p><img loading="lazy" alt="Membership Detail" src="/gameone/assets/images/membership-detail-6473e3d43debc8229cfa5c7b4e533f91.png" width="802" height="391" class="img_ev3q"></p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="twin-module">Twin Module<a href="#twin-module" class="hash-link" aria-label="Twin Module的直接链接" title="Twin Module的直接链接">​</a></h3><p>The main responsibility of the twin module is to deal with all the device twin related operations. It can perform
operations like device twin update, device twin get and device twin sync-to-cloud.</p><p>The major functions performed by this module are:</p><ol><li>Initialize action callback map (which is a  map of action(string) to the callback function that performs the requested action)</li><li>Receive the messages sent to twin module</li><li>For each message the action message is read and the corresponding function is called</li><li>Receive heartbeat from the heartbeat channel and send a heartbeat to the controller</li></ol><p>The following are the action callbacks which can be performed by the twin module:</p><ul><li>dealTwinUpdate</li><li>dealTwinGet</li><li>dealTwinSync</li></ul><p><strong>dealTwinUpdate</strong>: dealTwinUpdate() updates the device twin information for a particular device.</p><ul><li><p>The devicetwin update message can either be received by edgehub module from the cloud or from
the MQTT broker through the eventbus component (mapper will publish a message on the device twin update topic) .</p></li><li><p>The message is then sent to the device twin controller from where it is sent to the device twin module.</p></li><li><p>The twin module updates the twin value in the database and sends the update result message to the communication module.</p></li><li><p>The communication module will in turn send the publish message to the MQTT broker through the eventbus.</p><p><img loading="lazy" alt="Device Twin Update" src="/gameone/assets/images/devicetwin-update-17449f6baa1e46079c8b96781a7735b4.png" width="938" height="496" class="img_ev3q"></p></li></ul><p><strong>dealTwinGet</strong>: dealTwinGet() provides the device twin  information for a particular device.</p><ul><li><p>The eventbus component  receives the message that arrives on the subscribed twin get topic and forwards the message to devicetwin controller, which further sends the message to twin module.</p></li><li><p>The twin module gets the devicetwin related information for the particular device and sends it to the communication module, it also handles errors that arise when the device is not found or if any internal problem occurs.</p></li><li><p>The communication module sends the information to the eventbus component, which publishes the result on the topic specified .</p><p><img loading="lazy" alt="Device Twin Get" src="/gameone/assets/images/devicetwin-get-4b00badd4e3c0d5f8206771525772bb0.png" width="725" height="307" class="img_ev3q"></p></li></ul><p><strong>dealTwinSync</strong>: dealTwinSync() syncs the device twin information to the cloud.</p><ul><li><p>The eventbus module receives the message on the subscribed twin cloud sync topic .</p></li><li><p>This message is then sent to the devicetwin controller from where it is sent to the twin module.</p></li><li><p>The twin module then syncs the twin information present in the database and sends the synced twin results to the communication module.</p></li><li><p>The communication module further sends the information to edgehub component which will in turn send the updates to the cloud through the websocket connection.</p></li><li><p>This function also performs operations like publishing the updated twin details  document, delta of the device twin as well as the update result (in case there is some error) to a specified topic through the communication module,
which sends the data to edgehub, which will send it to eventbus which publishes on the MQTT broker.</p><p><img loading="lazy" alt="Sync to Cloud" src="/gameone/assets/images/sync-to-cloud-42e16c08a541debc0cf871a275ef800e.png" width="953" height="523" class="img_ev3q"></p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="communication-module">Communication Module<a href="#communication-module" class="hash-link" aria-label="Communication Module的直接链接" title="Communication Module的直接链接">​</a></h3><p>The main responsibility of communication module is to ensure the communication functionality between device twin  and the other components.</p><p>The major functions performed by this module are:-</p><ol><li>Initialize action callback map which is a map<!-- -->[string]<!-- -->Callback that contains the callback functions that can be performed</li><li>Receive the messages sent to communication module</li><li>For each message the action message is read and the corresponding function is called</li><li>Confirm whether the actions specified in the message are completed or not, if the action is not completed then redo the action</li><li>Receive heartbeat from the heartbeat channel and send a heartbeat to the controller</li></ol><p>The following are the action callbacks which can be performed by the communication module :</p><ul><li>dealSendToCloud</li><li>dealSendToEdge</li><li>dealLifeCycle</li><li>dealConfirm</li></ul><p><strong>dealSendToCloud</strong>: dealSendToCloud() is used to send data to the cloudHub component.
This function first ensures that the cloud is connected, then sends the message to the edgeHub module (through the beehive framework),
which in turn will forward the message to the cloud (through the websocket connection).</p><p><strong>dealSendToEdge</strong>:  dealSendToEdge() is used to send data to the other modules present at the edge.
This function sends the message received to the edgeHub module using beehive framework.
The edgeHub module after receiving the message will send it to the required recipient.</p><p><strong>dealLifeCycle</strong>:   dealLifeCycle() checks if the cloud is connected and the state of the twin is disconnected, it then changes the status
to connected and sends the node details to edgehub. If the cloud is disconnected then, it sets the state of the twin
as disconnected.</p><p><strong>dealConfirm</strong>:     dealConfirm() is used to confirm the event. It checks whether the type of the message is right and
then deletes the id from the confirm map.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="device-module">Device Module<a href="#device-module" class="hash-link" aria-label="Device Module的直接链接" title="Device Module的直接链接">​</a></h3><p>The main responsibility of the device module is to perform the device related operations like dealing with device state updates
and device attribute updates.</p><p>The major functions performed by this module are:</p><ol><li>Initialize action callback map (which is a  map of action(string) to the callback function that performs the requested action)</li><li>Receive the messages sent to device module</li><li>For each message the action message is read and the corresponding function is called</li><li>Receive heartbeat from the heartbeat channel and send a heartbeat to the controller</li></ol><p>The following are the action callbacks which can be performed by the device module:</p><ul><li><p>dealDeviceUpdated</p></li><li><p>dealDeviceStateUpdate</p><p><strong>dealDeviceUpdated</strong>: dealDeviceUpdated() deals with the operations to be performed when a device attribute update is encountered.
It updates the changes to the device attributes, like addition of attributes, updation of attributes and deletion of attributes
in the database. It also sends the result of the device attribute update to be published to the eventbus component.</p></li><li><p>The device attribute updation is initiated from the cloud, which sends the update to edgehub.</p></li><li><p>The edgehub component sends the message to the device twin controller which forwards the message to the device module.</p></li><li><p>The device module updates the device attribute details into the database after which, the device module sends the result of the device attribute update to be published
to the eventbus component through the communicate module of devicetwin. The eventbus component further publishes the result on the specified topic.</p><p> <img loading="lazy" alt="Device Update" src="/gameone/assets/images/device-update-d804e4b9374d23f2d489ba915fbc1595.png" width="848" height="483" class="img_ev3q"></p><p><strong>dealDeviceStateUpdate</strong>:  dealDeviceStateUpdate() deals with the operations to be performed when a device status update is encountered.
It updates the state of the device as well as the last online time of the device in the database.
It also sends the update state result, through the communication module,  to the cloud through the edgehub module and to the  eventbus module which in turn
publishes the result on the specified topic of the MQTT broker.</p></li><li><p>The device state updation is initiated by publishing a message on the specified topic which is being subscribed by the eventbus component.</p></li><li><p>The eventbus component sends the message to the device twin controller which forwards the message to the device module.</p></li><li><p>The device module updates the state of the device as well as the last online time of the device in the database.</p></li><li><p>The device module then sends the result of the device state update to the eventbus component and edgehub component through the communicate module of devicetwin. The eventbus component further publishes the result on the specified topic, while the
edgehub component sends the device status update to the cloud.</p><p><img loading="lazy" alt="Device State Update" src="/gameone/assets/images/device-state-update-237c465bf33c2ceb44bca0af87292dad.png" width="1073" height="483" class="img_ev3q"></p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tables">Tables<a href="#tables" class="hash-link" aria-label="Tables的直接链接" title="Tables的直接链接">​</a></h2><p>DeviceTwin module creates three tables in the database, namely:</p><ul><li>Device Table</li><li>Device Attribute Table</li><li>Device Twin Table</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="device-table">Device Table<a href="#device-table" class="hash-link" aria-label="Device Table的直接链接" title="Device Table的直接链接">​</a></h3><p>Device table contains the data regarding the devices added to a particular edge node.
The following are the columns present in the device table :</p><table><thead><tr><th>Column Name</th><th>Description</th></tr></thead><tbody><tr><td><strong>ID</strong></td><td>This field indicates the id assigned to the device</td></tr><tr><td><strong>Name</strong></td><td>This field indicates the name of the device</td></tr><tr><td><strong>Description</strong></td><td>This field indicates the description of the device</td></tr><tr><td><strong>State</strong></td><td>This field indicates the state of the device</td></tr><tr><td><strong>LastOnline</strong></td><td>This fields indicates when the device was last online</td></tr></tbody></table><p><strong>Operations Performed:</strong></p><p>The following are the operations that can be performed on this data:</p><ul><li><p><strong>Save Device</strong>: Inserts a device in the device table</p></li><li><p><strong>Delete Device By ID</strong>: Deletes a device by its ID from the device table</p></li><li><p><strong>Update Device Field</strong>: Updates a single field in the device table</p></li><li><p><strong>Update Device Fields</strong>: Updates multiple fields in the device table</p></li><li><p><strong>Query Device</strong>: Queries a device from the device table</p></li><li><p><strong>Query Device All</strong>: Displays all the devices present in the device table</p></li><li><p><strong>Update Device Multi</strong>: Updates multiple columns of multiple devices in the device table</p></li><li><p><strong>Add Device Trans</strong>: Inserts device, device attribute and device twin in a single transaction, if any of these operations fail,
then it rolls back the other insertions</p></li><li><p><strong>Delete Device Trans</strong>: Deletes device, device attribute and device twin in a single transaction, if any of these operations fail,
then it rolls back the other deletions</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="device-attribute-table">Device Attribute Table<a href="#device-attribute-table" class="hash-link" aria-label="Device Attribute Table的直接链接" title="Device Attribute Table的直接链接">​</a></h3><p>Device attribute table contains the data regarding the device attributes associated with a particular device in the edge node.
The following are the columns present in the device attribute table :</p><table><thead><tr><th>Column Name</th><th>Description</th></tr></thead><tbody><tr><td><strong>ID</strong></td><td>This field indicates the id assigned to the device attribute</td></tr><tr><td><strong>DeviceID</strong></td><td>This field indicates the device id of the device associated with this attribute</td></tr><tr><td><strong>Name</strong></td><td>This field indicates the name of the device attribute</td></tr><tr><td><strong>Description</strong></td><td>This field indicates the description of the device attribute</td></tr><tr><td><strong>Value</strong></td><td>This field indicates the value of the device attribute</td></tr><tr><td><strong>Optional</strong></td><td>This fields indicates whether the device attribute is optional or not</td></tr><tr><td><strong>AttrType</strong></td><td>This fields indicates the type of attribute that is referred to</td></tr><tr><td><strong>Metadata</strong></td><td>This fields describes the metadata associated with the device attribute</td></tr></tbody></table><p><strong>Operations Performed:</strong></p><p>The following are the operations that can be performed on this data :</p><ul><li><p><strong>Save Device Attr</strong>: Inserts a device attribute in the device attribute table</p></li><li><p><strong>Delete Device Attr By ID</strong>: Deletes a device attribute by its ID from the device attribute table</p></li><li><p><strong>Delete Device Attr</strong>: Deletes a device attribute from the device attribute table by filtering based on device id and device name</p></li><li><p><strong>Update Device Attr Field</strong>: Updates a single field in the device attribute table</p></li><li><p><strong>Update Device Attr Fields</strong>: Updates multiple fields in the device attribute table</p></li><li><p><strong>Query Device Attr</strong>: Queries a device attribute from the device attribute table</p></li><li><p><strong>Update Device Attr Multi</strong>: Updates multiple columns of multiple device attributes in the device attribute table</p></li><li><p><strong>Delete Device Attr Trans</strong>: Inserts device attributes, deletes device attributes and updates device attributes in a single transaction.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="device-twin-table">Device Twin Table<a href="#device-twin-table" class="hash-link" aria-label="Device Twin Table的直接链接" title="Device Twin Table的直接链接">​</a></h3><p>Device twin table contains the data related to the device device twin associated with a particular device in the edge node.
The following are the columns present in the device twin table :</p><table><thead><tr><th>Column Name</th><th>Description</th></tr></thead><tbody><tr><td><strong>ID</strong></td><td>This field indicates the id assigned to the device twin</td></tr><tr><td><strong>DeviceID</strong></td><td>This field indicates the device id of the device associated with this device twin</td></tr><tr><td><strong>Name</strong></td><td>This field indicates the name of the device twin</td></tr><tr><td><strong>Description</strong></td><td>This field indicates the description of the device twin</td></tr><tr><td><strong>Expected</strong></td><td>This field indicates the expected value of the device</td></tr><tr><td><strong>Actual</strong></td><td>This field indicates the actual value of the device</td></tr><tr><td><strong>ExpectedMeta</strong></td><td>This field indicates the metadata associated with the expected value of the device</td></tr><tr><td><strong>ActualMeta</strong></td><td>This field indicates the metadata associated with the actual value of the device</td></tr><tr><td><strong>ExpectedVersion</strong></td><td>This field indicates the version of the expected value of the device</td></tr><tr><td><strong>ActualVersion</strong></td><td>This field indicates the version of the actual value of the device</td></tr><tr><td><strong>Optional</strong></td><td>This fields indicates whether the device twin is optional or not</td></tr><tr><td><strong>AttrType</strong></td><td>This fields indicates the type of attribute that is referred to</td></tr><tr><td><strong>Metadata</strong></td><td>This fields describes the metadata associated with the device twin</td></tr></tbody></table><p><strong>Operations Performed:</strong></p><p>The following are the operations that can be performed on this data:</p><ul><li><p><strong>Save Device Twin</strong>: Inserts a device twin in the device twin table</p></li><li><p><strong>Delete Device Twin By Device ID</strong>: Deletes a device twin by its ID from the device twin table</p></li><li><p><strong>Delete Device Twin</strong>: Deletes a device twin from the device twin table by filtering based on device id and device name</p></li><li><p><strong>Update Device Twin Field</strong>: Updates a single field in the device twin table</p></li><li><p><strong>Update Device Twin Fields</strong>: Updates multiple fields in the device twin table</p></li><li><p><strong>Query Device Twin</strong>: Queries a device twin from the device twin table</p></li><li><p><strong>Update Device Twin Multi</strong>: Updates multiple columns of multiple device twins in the device twin table</p></li><li><p><strong>Delete Device Twin Trans</strong>: Inserts device twins, deletes device twins and updates device twins in a single transaction.</p></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/kubeedge/website/blob/master/docs/architecture/edge/devicetwin.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/gameone/docs/architecture/edge/edgehub"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">EdgeHub</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/gameone/docs/architecture/edge/metamanager"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">MetaManager</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#operations-performed-by-device-twin-controller" class="table-of-contents__link toc-highlight">Operations Performed By Device Twin Controller</a><ul><li><a href="#sync-metadata-tofrom-db--sqlite-" class="table-of-contents__link toc-highlight">Sync Metadata to/from db ( Sqlite )</a></li><li><a href="#register-and-start-sub-modules" class="table-of-contents__link toc-highlight">Register and Start Sub Modules</a></li><li><a href="#distribute-message-to-sub-modules" class="table-of-contents__link toc-highlight">Distribute Message To Sub Modules</a></li><li><a href="#health-check" class="table-of-contents__link toc-highlight">Health Check</a></li></ul></li><li><a href="#modules" class="table-of-contents__link toc-highlight">Modules</a><ul><li><a href="#membership-module" class="table-of-contents__link toc-highlight">Membership Module</a></li><li><a href="#twin-module" class="table-of-contents__link toc-highlight">Twin Module</a></li><li><a href="#communication-module" class="table-of-contents__link toc-highlight">Communication Module</a></li><li><a href="#device-module" class="table-of-contents__link toc-highlight">Device Module</a></li></ul></li><li><a href="#tables" class="table-of-contents__link toc-highlight">Tables</a><ul><li><a href="#device-table" class="table-of-contents__link toc-highlight">Device Table</a></li><li><a href="#device-attribute-table" class="table-of-contents__link toc-highlight">Device Attribute Table</a></li><li><a href="#device-twin-table" class="table-of-contents__link toc-highlight">Device Twin Table</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">2023 © GameOne Project Authors. All rights reserved. GameOne项目组，版权所有！</div></div></div></footer></div>
<script src="/gameone/assets/js/runtime~main.ff278b7d.js"></script>
<script src="/gameone/assets/js/main.b549cb7b.js"></script>
</body>
</html>